{% extends "store/layout.html" %}
{% load static %}
{% block body %}
<header>
    <img class="img-fluid" src="{% static 'Images/imizone.png' %}" alt="imiZON">
    <h1>Invoice</h1>
</header>

<p><strong>Name: </strong>{{ user.username }}</p>
<table style="width:100%">
    <tr>
        <th style="width:50%">Item</th>
        <th style="width:20%">Quantity</th>
        <th style="width:30%">Price</th>
    </tr>
    {% if orders %}
    {% for order in orders %}
    <tr>
        <td>{{ order.product.name }}</td>
        <td>{{ order.quantity }}</td>
        <td>{{ order.product.price }}</td>
    </tr>
    {% endfor %}
    {% endif %}
</table>
<div>
    <h3>Total Amount: Rs: {{ total }}</h3>
    <p>Your order has been placed successfully. Thank you for shopping with us!</p>
</div>
<form action="{% url 'complete_purchase' %}" method="POST">
    {% csrf_token %}
    <div class="checkout">
        <h3>Choose Payment Method</h3>
        <label>
            <input type="radio" name="payment_method" value="wallet" required> Wallet (Balance: Rs. {{ request.user.userprofile.wallet_balance }})
        </label>
        <label>
            <input type="radio" name="payment_method" value="cod" required> Cash on Delivery
        </label>

        <button type="submit" class="btn btn-grn">Complete Purchase</button>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const walletBalance = {{ request.user.userprofile.wallet_balance }};
        const totalAmount = {{ total }};

        if (walletBalance < totalAmount) {
            alert("Insufficient wallet balance. Please add funds to your wallet or choose a different payment method.");
        }
    });
</script>
{% endblock %}
